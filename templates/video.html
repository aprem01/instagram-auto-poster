{% extends "base.html" %}

{% block title %}Create Video - DVCCC Content Manager{% endblock %}

{% block content %}
<div class="card" id="createCard">
    <h2>Create Video Content</h2>
    <p style="color: #666; margin-bottom: 20px;">Generate video content for Instagram Reels and Stories</p>

    <div class="form-group">
        <label>Quick Theme Ideas (click to use)</label>
        <div class="theme-chips">
            {% for theme in themes %}
            <span class="theme-chip" onclick="selectTheme('{{ theme }}')">{{ theme }}</span>
            {% endfor %}
        </div>
    </div>

    <form id="videoForm">
        <div class="form-group">
            <label for="theme">Your Theme / Topic</label>
            <input type="text" id="theme" name="theme" placeholder="Enter a theme for your video..." required>
        </div>

        <div class="form-group">
            <label>Video Type</label>
            <div class="video-types">
                <label class="video-type-option">
                    <input type="radio" name="video_type" value="slideshow" checked>
                    <span class="video-type-card">
                        <span class="video-type-icon">üñºÔ∏è</span>
                        <strong>Image Slideshow</strong>
                        <small>Generate 3 images for a slideshow video</small>
                    </span>
                </label>
                <label class="video-type-option">
                    <input type="radio" name="video_type" value="ai_generated">
                    <span class="video-type-card">
                        <span class="video-type-icon">üé¨</span>
                        <strong>AI Video</strong>
                        <small>Generate video using AI (requires setup)</small>
                    </span>
                </label>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">
            <span>Generate Video Content</span>
        </button>
    </form>
</div>

<div id="loading" class="card loading">
    <div class="spinner"></div>
    <p>Generating your video content...</p>
    <p style="color: #666; font-size: 0.9rem; margin-top: 10px;">This may take 1-2 minutes for slideshow</p>
</div>

<div id="result" class="card" style="display: none;">
    <h2>Your Video Content</h2>

    <div id="slideshowResult" style="display: none;">
        <p style="margin-bottom: 20px;">Here are your slideshow images. Use these in Instagram Reels or a video editing app:</p>

        <div class="slideshow-grid" id="slideshowImages">
            <!-- Images will be inserted here -->
        </div>

        <div class="form-group" style="margin-top: 30px;">
            <label>Caption for Video</label>
            <textarea id="videoCaption" rows="4"></textarea>
        </div>

        <div class="tips-card">
            <h3>How to Create Your Reel</h3>
            <ol>
                <li>Download all images above</li>
                <li>Open Instagram and tap the + button</li>
                <li>Select "Reel"</li>
                <li>Add your images and set duration for each</li>
                <li>Add music and effects</li>
                <li>Paste the caption and post!</li>
            </ol>
        </div>
    </div>

    <div id="aiVideoResult" style="display: none;">
        <div class="ai-video-info">
            <h3>AI Video Generation</h3>
            <p>To generate AI videos, you'll need to set up one of these services:</p>

            <div class="service-options">
                <div class="service-card">
                    <h4>Runway ML</h4>
                    <p>Professional AI video generation</p>
                    <a href="https://runwayml.com" target="_blank" class="btn btn-secondary">Visit Runway</a>
                </div>
                <div class="service-card">
                    <h4>Pika Labs</h4>
                    <p>Creative AI video tool</p>
                    <a href="https://pika.art" target="_blank" class="btn btn-secondary">Visit Pika</a>
                </div>
                <div class="service-card">
                    <h4>Luma AI</h4>
                    <p>Dream Machine for video</p>
                    <a href="https://lumalabs.ai" target="_blank" class="btn btn-secondary">Visit Luma</a>
                </div>
            </div>

            <div class="form-group" style="margin-top: 20px;">
                <label>Use this prompt for AI video generation:</label>
                <textarea id="videoPrompt" rows="3" readonly style="background: #f5f5f5;"></textarea>
                <button onclick="copyPrompt()" class="btn btn-secondary" style="margin-top: 10px;">Copy Prompt</button>
            </div>

            <div class="form-group">
                <label>Caption for Video</label>
                <textarea id="aiVideoCaption" rows="4"></textarea>
            </div>
        </div>
    </div>

    <div style="margin-top: 20px; display: flex; gap: 10px;">
        <button onclick="resetForm()" class="btn btn-secondary">Create Another</button>
        <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Back to Dashboard</a>
    </div>
</div>

<style>
    .video-types {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }

    @media (max-width: 600px) {
        .video-types {
            grid-template-columns: 1fr;
        }
    }

    .video-type-option {
        cursor: pointer;
    }

    .video-type-option input {
        display: none;
    }

    .video-type-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 25px 20px;
        background: #f5f5f5;
        border: 2px solid transparent;
        border-radius: 12px;
        transition: all 0.3s;
    }

    .video-type-option input:checked + .video-type-card {
        background: #e8f4fc;
        border-color: #667eea;
    }

    .video-type-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
    }

    .video-type-card strong {
        display: block;
        margin-bottom: 5px;
    }

    .video-type-card small {
        color: #666;
        font-size: 0.85rem;
    }

    .slideshow-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
    }

    @media (max-width: 600px) {
        .slideshow-grid {
            grid-template-columns: 1fr;
        }
    }

    .slideshow-item {
        position: relative;
    }

    .slideshow-item img {
        width: 100%;
        aspect-ratio: 9/16;
        object-fit: cover;
        border-radius: 12px;
    }

    .slideshow-item .slide-number {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
    }

    .slideshow-item a {
        display: block;
        text-align: center;
        margin-top: 10px;
        color: #667eea;
        text-decoration: none;
        font-size: 0.9rem;
    }

    .tips-card {
        background: #f9f9f9;
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
    }

    .tips-card h3 {
        margin-bottom: 15px;
        color: #333;
    }

    .tips-card ol {
        padding-left: 20px;
        line-height: 1.8;
    }

    .service-options {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin: 20px 0;
    }

    @media (max-width: 768px) {
        .service-options {
            grid-template-columns: 1fr;
        }
    }

    .service-card {
        background: #f5f5f5;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
    }

    .service-card h4 {
        margin-bottom: 5px;
    }

    .service-card p {
        color: #666;
        font-size: 0.85rem;
        margin-bottom: 15px;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    let currentData = {};

    function selectTheme(theme) {
        document.getElementById('theme').value = theme;
    }

    document.getElementById('videoForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const theme = document.getElementById('theme').value;
        const videoType = document.querySelector('input[name="video_type"]:checked').value;

        if (!theme) return;

        // Show loading
        document.getElementById('createCard').style.display = 'none';
        document.getElementById('loading').style.display = 'block';
        document.getElementById('result').style.display = 'none';

        try {
            const response = await fetch('/generate/video', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ theme, video_type: videoType })
            });

            const data = await response.json();

            if (data.error) {
                alert('Error: ' + data.error);
                document.getElementById('createCard').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
                return;
            }

            currentData = data;

            // Show appropriate result
            document.getElementById('loading').style.display = 'none';
            document.getElementById('result').style.display = 'block';

            if (data.video_type === 'slideshow') {
                document.getElementById('slideshowResult').style.display = 'block';
                document.getElementById('aiVideoResult').style.display = 'none';

                // Populate slideshow images
                const container = document.getElementById('slideshowImages');
                container.innerHTML = data.images.map((url, i) => `
                    <div class="slideshow-item">
                        <span class="slide-number">${i + 1}</span>
                        <img src="${url}" alt="Slide ${i + 1}">
                        <a href="${url}" download target="_blank">Download Image</a>
                    </div>
                `).join('');

                document.getElementById('videoCaption').value = data.caption;
            } else {
                document.getElementById('slideshowResult').style.display = 'none';
                document.getElementById('aiVideoResult').style.display = 'block';

                document.getElementById('videoPrompt').value = data.prompt || '';
                document.getElementById('aiVideoCaption').value = data.caption;
            }

        } catch (error) {
            alert('Error generating video content: ' + error.message);
            document.getElementById('createCard').style.display = 'block';
            document.getElementById('loading').style.display = 'none';
        }
    });

    function copyPrompt() {
        const prompt = document.getElementById('videoPrompt');
        prompt.select();
        document.execCommand('copy');
        alert('Prompt copied to clipboard!');
    }

    function resetForm() {
        document.getElementById('theme').value = '';
        currentData = {};

        document.getElementById('createCard').style.display = 'block';
        document.getElementById('result').style.display = 'none';
    }
</script>
{% endblock %}
